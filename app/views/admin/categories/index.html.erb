<div class="page-header">
  <h1>Categories <span class="badge"><%= @categories.size %></span></h1>
</div>

<p>
  <a data-toggle="collapse" href="#collapseAddCatForm" aria-expanded="false">
    <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
     Add Category
  </a>
</p>
<%= render "shared/error", object: @category %>
<div class="collapse" id="collapseAddCatForm">
  <div class="row">
  
    <div class="col-xs-12 col-sm-8 well">
      <%= render "form" %>
    </div>
  </div>
</div>

<div class="row">
  <% @categories.order("updated_at DESC").each do |p| %>
    <div class="col-sm-4 col-md-3">
      <div class="thumbnail admin-category-thumbnail <%= 'invisible_thumbnail' if !p.visible %>">
        <% image = p.image.url
           image.nil? ? ((img_url = "http://thedudeminds.de/images/no_image_available.png") && thumb_img_url = img_url) : (img_url = image && thumb_img_url = p.image.thumb.url)
          %>
        <%= link_to admin_category_products_path(p) do %>
          <%= image_tag thumb_img_url %>
        <% end %>
        <div class="caption">
          <h4 id="cat-name" data-toggle="modal" data-target="#editCatName" data-edit=<%= admin_category_path(p) %> data-title=<%=p.name %> data-img=<%= thumb_img_url %> data-img-name=<%= p.image_identifier %>>
            <%= p.name %>
          </h4>
          <p> 
            <button type="button" class="btn <%= p.visible? ? "btn-primary" : "btn-default" %> btn-sm" id="cat-status" data-edit=<%= admin_category_visible_switch_path(p) %> data-visible=<%= p.visible? %>><%= p.visible? ? "visible" : "hidden" %></button>
          </td>
          </p>
          <p>
              <%= link_to "Delete", admin_category_path(p), class: "btn btn-danger btn-sm", method: :delete, data: { confirm: "Are you sure?" } %>
              <%= link_to "Shop", category_path(p), class: "pull-right" %>
          </p>
          <small>
          <% p.updated_at.nil? ? update_time = p.created_at.to_formatted_s(:db) : update_time = p.updated_at.to_formatted_s(:db) %>
          <%= update_time %> <em>(last updated)</em></small>
          <span class="badge pull-right"><%= p.products.size %></span>
        </div>
      </div>

    </div>
  <% end %>
</div>

<%# Modal %>
<div class="modal fade" id="editCatName" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="editCatNameLabel">Edit Category</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-xs-12 col-sm-6">
            <p>Name:</p>
            <input type="text" id="editCatNameInput" placeholder="">
          </div>
          <div class="col-xs-12 col-sm-6">
            <%= image_tag "http://thedudeminds.de/images/thedukegirls.png", width: "150", id: "cat_img_preview", class: "thumbnail" %>
            <%= file_field :category, :image, accept: 'image/png,image/gif,image/jpeg' %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="editCatNameConfirm">Save</button>
      </div>
    </div>
  </div>
</div>

<%# Pagination %>
<%= render 'shared/pagination', objects: @categories %>
